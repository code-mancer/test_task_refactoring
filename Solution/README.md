## Рефакторинг и корректировка ошибок:
* Избавиться от глобальных зависимостей:

* Заменить использование $_REQUEST на передачу данных напрямую в метод.
Вынести логику отправки уведомлений:

* Можно вынести логику отправки уведомлений в отдельный класс/сервис.
Обработка исключений:

* Предоставить более ясные исключения для различных сценариев ошибок.
Улучшить структуру кода:

* Меньше повторяющегося кода.
Использовать приватные методы для разбиения больших функций на более мелкие части.
Добавить комментарии и типы данных:

* Это поможет улучшить читаемость и понимание кода.